<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>UIWebViewçš„åŠ è½½è¿›åº¦æ¡ | å¤œæ»¡è¥¿æ¥¼çš„åšå®¢</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">UIWebViewçš„åŠ è½½è¿›åº¦æ¡</h1><a id="logo" href="/.">å¤œæ»¡è¥¿æ¥¼çš„åšå®¢</a><p class="description">è¿æ°”å°±æ˜¯æœºä¼šç¢°å·§æ’åˆ°äº†ä½ çš„åŠªåŠ›ã€‚</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">UIWebViewçš„åŠ è½½è¿›åº¦æ¡</h1><div class="post-meta">Mar 17, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><a class="disqus-comment-count" data-disqus-identifier="2017/03/17/UIWebViewçš„åŠ è½½è¿›åº¦æ¡/" href="/2017/03/17/UIWebViewçš„åŠ è½½è¿›åº¦æ¡/#disqus_thread"></a><div class="post-content"><h3 id="å¯¼è¯­"><a href="#å¯¼è¯­" class="headerlink" title="å¯¼è¯­"></a>å¯¼è¯­</h3><p>åœ¨ä¸€ä¸ªé˜³å…‰æ˜åªšçš„åˆåï¼Œç»„ç»‡ç»ˆäºå†³å®šæŠŠå…¬å¸çš„SDKäº§å“ï¼Œç”±Nativeæ›´æ¢æˆH5ï¼Œä½ æ²¡çœ‹é”™ï¼Œå°±æ˜¯ç”¨Nativeç•Œé¢åšçš„SDKï¼Œè¯´å¤šäº†éƒ½æ˜¯çœ¼æ³ªã€‚äº§å“è¯´ï¼Œç½‘é¡µåŠ è½½çš„æ—¶å€™è¦æœ‰è¿›åº¦æ¡ï¼ŒOKï¼Œæ²¡é—®é¢˜ï¼Œä¸€ä¸ªå­—å°±æ˜¯<strong>â€œå¹²â€</strong>ï¼Œä½ æ‡‚çš„ã€‚</p>
<blockquote>
<p>ç°åœ¨çš„iOS åº”ç”¨ä¸­ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰H5é¡µï¼Œå› ä¸ºH5æœ‰Nativeæ‰€ä¸å…·å¤‡çš„çµæ´»æ€§ï¼Œæ¯”å¦‚åº”ç”¨ä¸­çš„æ´»åŠ¨å±•ç¤ºï¼Œéœ€è¦ä¸å®šæ—¶çš„æ›´æ–°ï¼Œä½¿ç”¨H5æ¥åšå°±èƒ½è½»æ¾æå®šï¼iOSä¸­å¸¸ç”¨çš„H5å®¹å™¨æœ‰ä¸¤ç§ï¼š<em>1ã€ UIWebView 2ã€WKWebViewã€‚</em></p>
<ul>
<li><strong>WKWebView</strong> æ˜¯<strong>iOS8.0</strong>ä»¥åå¼€æ”¾çš„APIï¼Œå¯ä»¥é€šè¿‡KVOæ¥ç›‘å¬<code>estimatedProgress</code>å±æ€§çš„å˜åŒ–æ¥è·å–å½“å‰ç½‘é¡µçš„åŠ è½½è¿›åº¦ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸ç”¨é€‚é…iOS6ã€iOS7<em>ï¼ˆå¤ªçˆ½äº†ï¼Œå¹¸ç¦æ„Ÿçˆ†æ£šæœ‰æœ¨æœ‰ï¼‰ï¼Œ</em>é‚£ä¹ˆä½ å¯ä»¥å¾ˆeasyçš„åšä¸€ä¸ªWebViewçš„è¿›åº¦æ¡ã€‚</li>
<li><strong>UIWebView</strong> å¦‚æœä½ çš„åº”ç”¨éœ€è¦é€‚é…iOS7ã€æˆ–è€…iOS6 æˆ–è€…æ›´æ—©ğŸ˜‚ã€‚UIWebViewæ˜¯ä½ ä¸äºŒçš„<em>ï¼ˆä¹Ÿæ˜¯å”¯ä¸€çš„ï¼‰</em>é€‰æ‹©ï¼ŒæŸ¥çœ‹ç³»ç»Ÿçš„APIåå¹¶æ²¡æœ‰å‘ç°å¯ä»¥è·å–åŠ è½½è¿›åº¦çš„é€”å¾„ï¼Œsoâ€¦ä½ çœ‹åˆ°çš„ç½‘é¡µæœ‰åŠ è½½è¿›åº¦ï¼Œå¦‚æœå®ƒæ˜¯ç”¨UIWebViewåŠ è½½çš„ï¼Œé‚£è¿›åº¦æ¡ä¸€å®šæ˜¯ <strong>å‡çš„ï¼ å‡çš„ï¼å‡çš„ï¼ğŸ˜</strong></li>
</ul>
</blockquote>
<p>åº”å•†æˆ·è¦æ±‚ï¼ŒSDKæœ€ä½éœ€è¦æ”¯æŒiOS6.0ï¼Œç„¶è€Œç»„ç»‡å¹¶æ²¡æœ‰6.0ç³»ç»Ÿçš„æµ‹è¯•æœºï¼Œé¢†å¯¼å†³å®šï¼ŒæŠŠSDKæœ€ä½æ”¯æŒçš„ç³»ç»Ÿä¸ºè®¾ä¸º6.0ï¼Œè™½ç„¶æ²¡æœ‰çœŸæœºè¯•è¿‡ï¼Œåˆ°åº•èƒ½ä¸èƒ½åœ¨6.0ç³»ç»Ÿä¸Šä½¿ç”¨ä¹ŸæœªçŸ¥ï¼Œé‰´äºè¿™äº›ï¼ŒH5åªèƒ½é€šè¿‡UIWebViewæ¥åŠ è½½äº†ã€‚</p>
<p>####åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæ¥ä¸ªæˆå“çš„æ•ˆæœå›¾ï¼š</p>
<h5 id="æ•ˆæœ1"><a href="#æ•ˆæœ1" class="headerlink" title="æ•ˆæœ1 "></a>æ•ˆæœ1 <img src="http://upload-images.jianshu.io/upload_images/1890873-e45931be0265dd9b.gif?imageMogr2/auto-orient/strip" alt="å›¾ç‰‡1"></h5><h5 id="æ•ˆæœ2"><a href="#æ•ˆæœ2" class="headerlink" title="æ•ˆæœ2"></a>æ•ˆæœ2<img src="http://upload-images.jianshu.io/upload_images/1890873-8a38ca6ae4a898fb.gif?imageMogr2/auto-orient/strip" alt="å›¾ç‰‡2"></h5><p><a href="https://github.com/jindk/WebViewProgress" target="_blank" rel="noopener">Demoä¸‹è½½é“¾æ¥</a></p>
<h4 id="1ã€ç¬¬ä¸€æ¬¡å°è¯•"><a href="#1ã€ç¬¬ä¸€æ¬¡å°è¯•" class="headerlink" title="1ã€ç¬¬ä¸€æ¬¡å°è¯•"></a>1ã€ç¬¬ä¸€æ¬¡å°è¯•</h4><p>è¿›åº¦æ¡å˜›ï¼Œç¬¬ä¸€ååº”å°±æ˜¯ç”¨ç³»ç»Ÿçš„<code>UIProgressView</code>ï¼Œç„¶è€Œè¯•è¿‡ä¹‹åæ‰å‘ç°ç³»ç»Ÿçš„<code>UIProgressView</code>é™åˆ¶å¤ªå¤šï¼Œå¯ä»¥è‡ªå®šä¹‰çš„å¤ªå°‘äº†ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚</p>
<h4 id="2ã€ç¬¬äºŒæ¬¡å°è¯•"><a href="#2ã€ç¬¬äºŒæ¬¡å°è¯•" class="headerlink" title="2ã€ç¬¬äºŒæ¬¡å°è¯•"></a>2ã€ç¬¬äºŒæ¬¡å°è¯•</h4><p>ç™¾åº¦ã€Googleä¸€ç•ªï¼Œå¥½å¤šé“å‹éƒ½å»ºè®®ä½¿ç”¨CAShapeLayeræ¥åšï¼Œå¥½å§ï¼Œ<strong>å¹²ï¼</strong><br>æŸ¥çœ‹ç³»ç»ŸCAShapeLayerçš„APIå‘ç°ï¼ŒCAShapeLayeræœ‰ä¸¤ä¸ªå±æ€§<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* These values define <span class="keyword">the</span> subregion <span class="keyword">of</span> <span class="keyword">the</span> path used <span class="keyword">to</span> draw <span class="keyword">the</span></span><br><span class="line"> * stroked outline. The values must be <span class="keyword">in</span> <span class="keyword">the</span> range [<span class="number">0</span>,<span class="number">1</span>] <span class="keyword">with</span> zero</span><br><span class="line"> * representing <span class="keyword">the</span> start <span class="keyword">of</span> <span class="keyword">the</span> path <span class="keyword">and</span> one <span class="keyword">the</span> <span class="keyword">end</span>. Values <span class="keyword">in</span></span><br><span class="line"> * <span class="keyword">between</span> zero <span class="keyword">and</span> one are interpolated linearly along <span class="keyword">the</span> path</span><br><span class="line"> * <span class="built_in">length</span>. strokeStart defaults <span class="keyword">to</span> zero <span class="keyword">and</span> strokeEnd <span class="keyword">to</span> one. Both are</span><br><span class="line"> * animatable. */</span><br><span class="line">@<span class="keyword">property</span> CGFloat strokeStart;</span><br><span class="line">@<span class="keyword">property</span> CGFloat strokeEnd;</span><br></pre></td></tr></table></figure></p>
<p>æ„æ€å°±æ˜¯CAShapeLayerçš„è®¾ç½®è¿™ä¸¤ä¸ªæè¾¹çš„èµ·å§‹å’Œç»“æŸä½ç½®æ˜¯æœ‰<strong>åŠ¨ç”»æ•ˆæœ</strong>çš„<br>è‡ªå®šä¸€ä¸ªç±»DKProgressLayerç»§æ‰¿è‡ªCAShapeLayer</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define DEVICE_WIDTH [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DKProgressLayer</span> : <span class="title">CAShapeLayer</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressColor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> è¿›åº¦æ¡å¼€å§‹åŠ è½½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)progressAnimationStart;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> è¿›åº¦æ¡åŠ è½½å®Œæˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)progressAnimationCompletion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DKProgressLayer</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> stepWidth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSTimeInterval</span> <span class="keyword">const</span> progressInterval = <span class="number">0.01</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DKProgressLayer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.progressColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        <span class="keyword">self</span>.stepWidth = <span class="number">0.01</span>;</span><br><span class="line">        <span class="keyword">self</span>.lineWidth = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">        [path moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">2</span>)];</span><br><span class="line">        [path addLineToPoint:<span class="built_in">CGPointMake</span>(DEVICE_WIDTH, <span class="number">2</span>)];</span><br><span class="line">        <span class="keyword">self</span>.path = path.CGPath;</span><br><span class="line">        <span class="keyword">self</span>.strokeEnd = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setProgressColor:(<span class="built_in">UIColor</span> *)progressColor &#123;</span><br><span class="line">    <span class="keyword">if</span> (!progressColor) &#123;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _progressColor = progressColor;</span><br><span class="line">    <span class="keyword">self</span>.progressColor = progressColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¸æ–­è®¾ç½®layeræè¾¹çš„ç»“æŸä½ç½® */</span></span><br><span class="line">- (<span class="keyword">void</span>)progressChanged:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="keyword">self</span>.strokeEnd += _stepWidth;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">self</span>.strokeEnd &gt; <span class="number">0.9</span>) &#123;</span><br><span class="line">          _stepWidth = <span class="number">0.0001</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)progressAnimationStart &#123;</span><br><span class="line">    <span class="keyword">self</span>.hidden = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">if</span> (_timer) &#123;</span><br><span class="line">        [<span class="keyword">self</span> invalidateTimer];</span><br><span class="line">    &#125;</span><br><span class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:progressInterval target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(progressChanged:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)progressAnimationCompletion &#123;</span><br><span class="line">    [<span class="keyword">self</span> invalidateTimer];</span><br><span class="line">    <span class="keyword">self</span>.strokeEnd = <span class="number">1.0</span>;</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">0.25</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.hidden = <span class="literal">YES</span>;</span><br><span class="line">        _stepWidth = <span class="number">0.01</span>;</span><br><span class="line">        <span class="keyword">self</span>.strokeEnd = <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)invalidateTimer &#123;</span><br><span class="line">    [_timer invalidate];</span><br><span class="line">    _timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>å¥½å§ï¼Œæ•ˆæœæ¥äº†ï¼š<img src="http://upload-images.jianshu.io/upload_images/1890873-e45931be0265dd9b.gif?imageMogr2/auto-orient/strip" alt="å›¾ç‰‡3"><br>So easy too Happyï¼Œæ‹¿ç»™äº§å“å»çœ‹â€¦â€¦</p>
<blockquote>
<p>äº§å“ï¼šè¿™ä¹Ÿå¤ªlowäº†å§<br>çŒ¿ï¼šæ¡è‰ï¼Œå¾®ä¿¡çš„æ•ˆæœå°±æ˜¯è¿™æ ·å¥½ä¸å¥½ï¼Œä¸èˆ¬é¡ºæ»‘ã€‚<br>äº§å“ï¼šä¸è¡Œï¼Œå¤ªå¤§ä¼—åŒ–äº†ï¼Œæ”¹æˆä¸€è¾¹åŠ è½½ä¸€è¾¹æ¸å˜çš„ï¼Œå‰è¾¹åŠ è½½ï¼Œåè¾¹æ¸éšçš„<br>çŒ¿ï¼šå°¼ç›â€¦â€¦é‚£ä¸å°±æ˜¯QQçš„åŠ è½½æ•ˆæœä¹ˆï¼Œé‚£å°±ä¸lowäº†å—ï¼Ÿ<br>äº§å“ï¼šæˆ‘å°±è¦é‚£æ ·çš„æ•ˆæœï¼Œä½ å°±å‘Šè¯‰æˆ‘èƒ½ä¸èƒ½åšï¼Ÿ<br>çŒ¿ï¼šä½ å¤§çˆ·â€¦â€¦</p>
</blockquote>
<h4 id="3ã€ç¬¬ä¸‰æ¬¡å°è¯•"><a href="#3ã€ç¬¬ä¸‰æ¬¡å°è¯•" class="headerlink" title="3ã€ç¬¬ä¸‰æ¬¡å°è¯•"></a>3ã€ç¬¬ä¸‰æ¬¡å°è¯•</h4><p>ç»§ç»­ç™¾åº¦ã€Googleï¼Œå¹¶æ²¡æœ‰å‘ç°å¾ˆå¥½çš„æ€è·¯ï¼Œå¿«è¦ç»æœ›çš„æ—¶å€™å‘ç°CAShapeLayeræœ‰ä¸€ä¸ªå­ç±»CAGradientLayer<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/* The array <span class="keyword">of</span> CGColorRef objects defining the color <span class="keyword">of</span> <span class="keyword">each</span> gradient</span><br><span class="line"> * <span class="keyword">stop</span>. Defaults <span class="keyword">to</span> nil. Animatable. */</span><br><span class="line"></span><br><span class="line">@<span class="keyword">property</span>(nullable, copy) NSArray *colors;</span><br><span class="line"></span><br><span class="line">/* An <span class="keyword">optional</span> array <span class="keyword">of</span> NSNumber objects defining the location <span class="keyword">of</span> <span class="keyword">each</span></span><br><span class="line"> * gradient <span class="keyword">stop</span> <span class="keyword">as</span> a value <span class="keyword">in</span> the range [<span class="number">0</span>,<span class="number">1</span>]. The values must be</span><br><span class="line"> * monotonically increasing. <span class="keyword">If</span> a nil array <span class="keyword">is</span> given, the stops are</span><br><span class="line"> * assumed <span class="keyword">to</span> spread uniformly across the [<span class="number">0</span>,<span class="number">1</span>] range. <span class="keyword">When</span> rendered,</span><br><span class="line"> * the colors are mapped <span class="keyword">to</span> the output colorspace before being</span><br><span class="line"> * interpolated. Defaults <span class="keyword">to</span> nil. Animatable. */</span><br><span class="line"></span><br><span class="line">@<span class="keyword">property</span>(nullable, copy) NSArray&lt;NSNumber *&gt; *locations;</span><br><span class="line"></span><br><span class="line">/* The start <span class="keyword">and</span> <span class="keyword">end</span> points <span class="keyword">of</span> the gradient <span class="keyword">when</span> drawn <span class="keyword">into</span> the layer<span class="comment">'s</span></span><br><span class="line"> * coordinate space. The start point corresponds <span class="keyword">to</span> the first gradient</span><br><span class="line"> * <span class="keyword">stop</span>, the <span class="keyword">end</span> point <span class="keyword">to</span> the last gradient <span class="keyword">stop</span>. Both points are</span><br><span class="line"> * defined <span class="keyword">in</span> a unit coordinate space that <span class="keyword">is</span> <span class="keyword">then</span> mapped <span class="keyword">to</span> the</span><br><span class="line"> * layer<span class="comment">'s bounds rectangle when drawn. (I.e. [0,0] is the bottom-left</span></span><br><span class="line"> * corner <span class="keyword">of</span> the layer, [<span class="number">1</span>,<span class="number">1</span>] <span class="keyword">is</span> the top-right corner.) The <span class="keyword">default</span> values</span><br><span class="line"> * are [<span class="number">.5</span>,<span class="number">0</span>] <span class="keyword">and</span> [<span class="number">.5</span>,<span class="number">1</span>] respectively. Both are animatable. */</span><br><span class="line"></span><br><span class="line">@<span class="keyword">property</span> CGPoint startPoint;</span><br><span class="line">@<span class="keyword">property</span> CGPoint endPoint;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹æ³¨é‡Šï¼Œè²Œä¼¼èƒ½è®¾ç½®èµ·å§‹ç‚¹ã€ç»ˆç‚¹ï¼Œè¿˜èƒ½è®¾ç½®å¤šç§é¢œè‰²ï¼Œè¿˜èƒ½è®¾ç½®é¢œè‰²çš„ä½ç½®ï¼Œæˆ‘å‡‘ï¼Œè¿™ä¸å°±èƒ½æ»¡è¶³äº§å“ğŸ¶çš„éœ€æ±‚äº†å—ï¼Ÿ å¿«è¯•è¯•â€¦â€¦æ­¤å¤„çœç•¥è¿‡ç¨‹ï¼Œç›´æ¥è´´ä»£ç äº†<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setProgressStyle:(DKProgressStyle)progressStyle &#123;</span><br><span class="line">    _progressStyle = progressStyle;</span><br><span class="line">    <span class="keyword">if</span> (progressStyle == DKProgressStyle_Gradual) &#123;</span><br><span class="line">        <span class="keyword">self</span>.strokeColor = <span class="literal">nil</span>;</span><br><span class="line">        <span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">        <span class="built_in">CGFloat</span> RGB[<span class="number">3</span>];</span><br><span class="line">        [<span class="keyword">self</span> getRGBComponents:RGB forColor:_progressColor];</span><br><span class="line">        gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> colorWithRed:RGB[<span class="number">0</span>] green:RGB[<span class="number">1</span>] blue:RGB[<span class="number">2</span>] alpha:<span class="number">0.2</span>].CGColor, (__bridge <span class="keyword">id</span>)_progressColor.CGColor];</span><br><span class="line">        gradientLayer.locations = @[@(<span class="number">0</span>), @(<span class="number">0</span>)];</span><br><span class="line">        gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1.0</span>, <span class="number">0</span>);</span><br><span class="line">        gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">        _gradientLayer = gradientLayer;</span><br><span class="line">        [<span class="keyword">self</span> addSublayer:gradientLayer];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)progressChanged:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="keyword">self</span>.strokeEnd += _stepWidth;</span><br><span class="line">    <span class="comment">/* è¶…è¿‡90% å‡ç¼“è¿›åº¦æ¡å¢é•¿é€Ÿåº¦ */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.strokeEnd &gt; <span class="number">0.9</span>) &#123;</span><br><span class="line">        _stepWidth = <span class="number">0.0001</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_progressStyle == DKProgressStyle_Gradual) &#123;</span><br><span class="line">        <span class="comment">/* ä¸æ–­æ”¹å˜layeré¢œè‰²çš„èµ·å§‹ä½ç½® */</span></span><br><span class="line">        _gradientLayer.locations = @[@(<span class="keyword">self</span>.strokeEnd/<span class="number">2</span>), @(<span class="keyword">self</span>.strokeEnd)];</span><br><span class="line">        <span class="comment">/* ä¸æ–­æ”¹å˜layerçš„frame */</span></span><br><span class="line">        _gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, DEVICE_WIDTH*<span class="keyword">self</span>.strokeEnd, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è·å–é¢œè‰²çš„RGBå€¼ */</span></span><br><span class="line">- (<span class="keyword">void</span>)getRGBComponents:(<span class="built_in">CGFloat</span> [<span class="number">3</span>])components forColor:(<span class="built_in">UIColor</span> *)color &#123;</span><br><span class="line">    <span class="keyword">if</span> (!color) &#123;</span><br><span class="line">        components[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        components[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        components[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> rgbColorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> resultingPixel[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">CGBitmapContextCreate</span>(&amp;resultingPixel, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, rgbColorSpace, kCGImageAlphaNoneSkipLast);</span><br><span class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(context, [color <span class="built_in">CGColor</span>]);</span><br><span class="line">    <span class="built_in">CGContextFillRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">CGContextRelease</span>(context);</span><br><span class="line">    <span class="built_in">CGColorSpaceRelease</span>(rgbColorSpace);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> component = <span class="number">0</span>; component &lt; <span class="number">3</span>; component++) &#123;</span><br><span class="line">        components[component] = resultingPixel[component] / <span class="number">255.0</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š<img src="http://upload-images.jianshu.io/upload_images/1890873-8a38ca6ae4a898fb.gif?imageMogr2/auto-orient/strip" alt="å›¾ç‰‡"></p>
<blockquote>
<p>äº§å“ï¼šè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä½ å¼„è¿™ä¹ˆä¹…ï¼Œå…ˆè¿™ä¹ˆç€å§ï¼Œæœ‰ä»€ä¹ˆæƒ³æ³•å†æ‰¾ä½ <br>çŒ¿ï¼šæˆ‘æ—¥å°¼ç›ï¼Œå‚»åŠâ€¦â€¦</p>
</blockquote>
<p>å¥½å§ï¼Œè¿™ä¸ªéœ€æ±‚å°±æš‚æ—¶å‘Šä¸€æ®µè½äº†ï¼Œäº§å“éœ€æ±‚æ¥äº†å†æ”¹å§ğŸ˜‚</p>
<p><a href="https://github.com/jindk/WebViewProgress" target="_blank" rel="noopener">æœ¬æ–‡githubé“¾æ¥</a>ï¼Œå¦‚æœä½ è§‰å¾—èƒ½å¸®åˆ°ä½ ï¼Œè·¯è¿‡ç»™ä¸ªStarå“ˆã€‚</p>
<p>######å‚è€ƒé“¾æ¥ï¼š<br><a href="http://www.jianshu.com/p/b32b9fb6cb0a" target="_blank" rel="noopener">http://www.jianshu.com/p/b32b9fb6cb0a</a>  æ„Ÿè°¢ä½œè€…çš„æ€è·¯</p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a class="pre" href="/2017/11/14/SDWebImageæºç æµ…æ/">SDWebImageæºç æµ…æ</a><a class="next" href="/2016/04/11/iOS æ–‡æœ¬é«˜åº¦è®¡ç®—/">iOS æ–‡æœ¬é«˜åº¦è®¡ç®—</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">é˜…è¯»è¯„è®ºï¼ˆè¯·ç¡®ä¿ Disqus å¯ä»¥æ­£å¸¸åŠ è½½ï¼‰</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://yoursite.com/2017/03/17/UIWebViewçš„åŠ è½½è¿›åº¦æ¡/';
    this.page.identifier = '2017/03/17/UIWebViewçš„åŠ è½½è¿›åº¦æ¡/';
    this.page.title = 'UIWebViewçš„åŠ è½½è¿›åº¦æ¡';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//https-dengkej-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//https-dengkej-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://https-dengkej-github-io.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/iOS/" style="font-size: 15px;">iOS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/14/SDWebImageæºç æµ…æ/">SDWebImageæºç æµ…æ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/17/UIWebViewçš„åŠ è½½è¿›åº¦æ¡/">UIWebViewçš„åŠ è½½è¿›åº¦æ¡</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/11/iOS æ–‡æœ¬é«˜åº¦è®¡ç®—/">iOS æ–‡æœ¬é«˜åº¦è®¡ç®—</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> æœ€è¿‘è¯„è®º</i></div><script type="text/javascript" src="//https-dengkej-github-io.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://github.com/DengkeJ" title="Github" target="_blank">Github</a><ul></ul><a href="http://boaihome.com" title="åšçˆ±1616çš„åšå®¢" target="_blank">åšçˆ±1616çš„åšå®¢</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/." rel="nofollow">å¤œæ»¡è¥¿æ¥¼çš„åšå®¢.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>